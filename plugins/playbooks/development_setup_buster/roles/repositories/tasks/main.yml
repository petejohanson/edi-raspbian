---
- name: Remove /etc/apt/sources.list.
  file: dest=/etc/apt/sources.list state=absent

- name: Add raspbian apt-key.
  apt_key: data="{{ lookup('file', 'raspbian.public.key') }}" state=present
  when: enable_cross_development

- name: Add buster repository for amd64 binaries.
  copy: src=buster.list dest=/etc/apt/sources.list.d
  when: enable_cross_development

- name: Add buster repository for sources.
  copy: src=buster.list dest=/etc/apt/sources.list.d
  when: enable_cross_development

- name: Add raspbian buster repository for armhf binaries.
  copy: src=raspbian_buster.list dest=/etc/apt/sources.list.d

- name: Add raspbian buster repository for sources.
  copy: src=raspbian_buster.list dest=/etc/apt/sources.list.d
  when: not enable_cross_development

- name: Update apt cache.
  apt: update_cache=yes

- name: Enable https package repositories.
  apt:
    name: apt-transport-https 
    state: present
  when: enable_cross_development

- name: Add key for cross compiler repository.
  apt_key:
    data: "{{ lookup('file', 'buster.key') }}"
    state: present
  when: enable_cross_development

- name: Increase priority of cross compiler repository.
  copy:
    src: buster-raspbian-cross
    dest: /etc/apt/preferences.d
  when: enable_cross_development

- name: Add sources list of cross compiler repository.
  copy:
    src: buster.list
    dest: /etc/apt/sources.list.d
  when: enable_cross_development

- name: Update apt cache.
  apt: update_cache=yes

